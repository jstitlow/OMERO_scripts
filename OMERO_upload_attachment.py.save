# Attach files to OMERO dataset
#
# ********NOTE********
# -change username to match your username
# -may need to change group, e.g., if None type error
# -takes command line arguments for -infile and -dataset
# -may need to change group, e.g., if None type error


from omero.gateway import BlitzGateway
import getpass

PASS = getpass.getpass("Enter Password:") 
conn = BlitzGateway('bioc1301', PASS, host='omero1.bioch.ox.ac.uk', port=4064, group='davisgroup')
conn.connect()

group = conn.getGroupFromContext()
print "Current group: ", group.getName()

dataset_id = '18905'
dataset = conn.getObject("Dataset", dataset_id)
print dataset
# Specify a local file e.g. could be result of some analysis
file_to_upload = 'README.txt'   # This file should already exist
#print file_to_upload
#with open(file_to_upload, 'w') as f:
#    f.write('annotation test')
# create the original file and file annotation (uploads the file etc.)
namespace = "imperial.training.demo"
print "\nCreating an OriginalFile and FileAnnotation"
file_ann = conn.createFileAnnfromLocalFile(file_to_upload, mimetype="text/plain", ns=namespace, desc=None)
print "Attaching FileAnnotation to Dataset: ", "File ID:", file_ann.getId(), \
    ",", file_ann.getFile().getName(), "Size:", file_ann.getFile().getSize()
dataset.linkAnnotation(file_ann)     # link it to dataset.
